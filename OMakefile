OCAMLPACKS[] = 
    equeue
    pcre
    str
OCAML_CLIBS = ocamlepoll
OCAMLCFLAGS += -g

.DEFAULT: ircd

StaticCLibrary(ocamlepoll, epoll_wrapper)

OCamlProgram(ircd, ircd irc command iobuf client channel)

section
    OCAMLPACKS[] +=
        oUnit
    NATIVE_ENABLED = false

    tests.cmx:
    tests.cmi:
    tests.cmo:
    tests$(EXT_OBJ):

    dispatch_tests.cmx:
    dispatch_tests.cmi:
    dispatch_tests.cmo:
    dispatch_tests$(EXT_OBJ):

    OCamlProgram(tests, tests dispatch chat irc command iobuf client channel)

.PHONY: test
test: tests
	./tests

.PHONY: clean
clean:
	rm $(filter-proper-targets $(ls R, .))
