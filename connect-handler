#! /bin/sh -e

# UCSPI wants communication on fd7
if [ -n "$PROTO" ]; then
    fd=7
else
    fd=1
fi

# Kick things off by logging in
if [ -x "$srvdir/login" ]; then
    $srvdir/login
else
    echo NICK $nick
    echo USER $nick $nick $nick :$nick
fi 1>& $fd

exec $ircdir/dispatch -f fifo $ircdir/irc-filter $ircdir/handler
